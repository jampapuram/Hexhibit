--------------------------------------------------------
--  File created - Friday-October-18-2013   
--------------------------------------------------------
--------------------------------------------------------
--  DDL for View HV_30CD
--------------------------------------------------------

  CREATE OR REPLACE FORCE VIEW "RIGEL"."HV_30CD" ("POS_MON", "POS_CURRENT", "D31_60", "D61_90", "D91_180", "G_180", "CD") AS 
  SELECT POS_MON,SUM(POS) POS_CURRENT,SUM(D31_60) D31_60,SUM(D61_90) D61_90,SUM(D91_180) D91_180,SUM(G_180) G_180,
ROUND(((SUM(D31_60)+SUM(D61_90)+SUM(D91_180)+SUM(G_180))/(SUM(POS) + SUM(D31_60)+ SUM(D61_90)+SUM(D91_180)+SUM(G_180))),5) CD
FROM 
(SELECT to_char(HAS.TXN_DT,'MONTH') POS_MON,
SUM(has.total_prin_os_base_amount) POS,NULL D31_60,NULL D61_90,NULL D91_180,NULL G_180
FROM hi_account_snapshot HAS
WHERE haS.org_id =777
GROUP BY to_char(HAS.TXN_DT,'MONTH') 
UNION ALL
SELECT to_char(DPD.EFFECTIVE_DT,'MONTH') POS_MON,
SUM(dpd.base_amt) POS, NULL D31_60,NULL D61_90,NULL D91_180,NULL G_180
FROM 
HI_COLLECTION_DPD DPD
WHERE DPD.org_id =777
AND DPD.DPD_CLASSIFICATION_DESC2 = 'DPD 1 (1 TO 30 DAYS)'
GROUP BY to_char(DPD.EFFECTIVE_DT,'MONTH')
UNION ALL
SELECT to_char(DPD.EFFECTIVE_DT,'MONTH') POS_MON,
NULL POS,SUM(dpd.base_amt) D31_60,NULL D61_90,NULL D91_180,NULL G_180
FROM 
HI_COLLECTION_DPD DPD
WHERE DPD.org_id =777
AND DPD.DPD_CLASSIFICATION_DESC2 = 'DPD 2 (31 TO 60 DAYS)'
GROUP BY to_char(DPD.EFFECTIVE_DT,'MONTH')
UNION ALL
SELECT to_char(DPD.EFFECTIVE_DT,'MONTH') POS_MON,
NULL POS,NULL D31_60,SUM(dpd.base_amt) D61_90,NULL D91_180,NULL G_180
FROM 
HI_COLLECTION_DPD DPD
WHERE DPD.org_id =777
AND DPD.DPD_CLASSIFICATION_DESC2 = 'DPD 3 (61 TO 90 DAYS)'
GROUP BY to_char(DPD.EFFECTIVE_DT,'MONTH')
UNION ALL
SELECT to_char(DPD.EFFECTIVE_DT,'MONTH') POS_MON,
NULL POS,NULL D31_60, NULL D61_90,SUM(dpd.base_amt) D91_180,NULL G_180
FROM 
HI_COLLECTION_DPD DPD
WHERE DPD.org_id =777
AND DPD.DPD_CLASSIFICATION_DESC2 = 'DPD 4 (90 TO 180 DAYS)'
GROUP BY to_char(DPD.EFFECTIVE_DT,'MONTH')
UNION ALL
SELECT to_char(DPD.EFFECTIVE_DT,'MONTH') POS_MON,
NULL POS,NULL D31_60, NULL D61_90,NULL D91_180,SUM(dpd.base_amt) G_180
FROM 
HI_COLLECTION_DPD DPD
WHERE DPD.org_id =777
AND DPD.DPD_CLASSIFICATION_DESC2 = 'DPD 5 (GREATER THEN 181 DAYS)'
GROUP BY to_char(DPD.EFFECTIVE_DT,'MONTH')) A
GROUP BY POS_MON;
REM INSERTING into RIGEL.HV_30CD
SET DEFINE OFF;
Insert into RIGEL.HV_30CD (POS_MON,POS_CURRENT,D31_60,D61_90,D91_180,G_180,CD) values ('AUGUST   ',26810711055.17,362782193.2,245149363.46,72086944.52,133634192.55,0.02945);
Insert into RIGEL.HV_30CD (POS_MON,POS_CURRENT,D31_60,D61_90,D91_180,G_180,CD) values ('APRIL    ',24422908736.09,189044431.17,182276567.9,35716040.76,127528444.78,0.02142);
Insert into RIGEL.HV_30CD (POS_MON,POS_CURRENT,D31_60,D61_90,D91_180,G_180,CD) values ('JUNE     ',25993200744.26,284941464.29,174399170.03,41991142.17,133795996.79,0.02385);
Insert into RIGEL.HV_30CD (POS_MON,POS_CURRENT,D31_60,D61_90,D91_180,G_180,CD) values ('MARCH    ',24049207793.23,204026316.65,163289023.94,38213427.9,126325336.52,0.02164);
Insert into RIGEL.HV_30CD (POS_MON,POS_CURRENT,D31_60,D61_90,D91_180,G_180,CD) values ('JULY     ',26377307910.57,299739230.47,234273752.4,60809014.74,135467481.12,0.02694);
Insert into RIGEL.HV_30CD (POS_MON,POS_CURRENT,D31_60,D61_90,D91_180,G_180,CD) values ('MAY      ',25418568665.83,326921675.44,173535609.8,53843349.08,130149605.36,0.02622);
