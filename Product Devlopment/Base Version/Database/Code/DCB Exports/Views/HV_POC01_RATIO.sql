--------------------------------------------------------
--  File created - Friday-October-18-2013   
--------------------------------------------------------
--------------------------------------------------------
--  DDL for View HV_POC01_RATIO
--------------------------------------------------------

  CREATE OR REPLACE FORCE VIEW "RIGEL"."HV_POC01_RATIO" ("WEEK_OF_YEAR", "MONTH_LONG", "MONTH_LONG_DESC", "QUARTER_ID", "HALF_OF_YEAR_ID", "YEAR_ID", "ORG_ID", "TXN_DT", "MONTHLY_POS", "PREVIOUS_MONTH_POS_AMT", "GROWTH_COUNT", "GROWTH_RATIO", "CURRENT_POS", "POS_COUNT", "TOTAL_INTEREST_OS_BASE_AMOUNT", "NPA_POS_AMOUNT", "PROVISION_PERCENTAGE", "PROVISION_AMOUNT", "COVERAGE_RATIO", "COVERAGE_COUNT", "SLIPPAGE_AMOUNT", "UPGRADE_AMOUNT", "NORMAL_RECOVERY_AMOUNT", "UNC_AMOUNT", "UNS_AMOUNT", "SCHEME_CODE", "AMOUNT_APPROVED", "PRODUCT_CODE", "PRODUCT_DESC1", "PROGRAM", "PROMOTION", "SOURCE_OFFICE_ID", "GEO_ID", "BUSINESS_LINE", "BUSINESS_SUBLINE", "PRODUCT", "FACILITY", "AGE_BRACKET", "NET_INCOME_BRACKET", "AGENCY_NAME1", "AGENCY_TYPE_DESC1", "CIBIL_SCORE", "LTV_DESC1", "DBR_DESC1", "RM_NAME", "PROPERTY_TPE", "BOUNCE_MONTH", "BOUNCE_COUNT", "PRESENTATION_COUNT", "BOUNCE_RATIO", "FORE_POS", "PREV_FORE_POS", "MATURITY_POS", "PREV_MATURITY_POS", "ROI", "PORTFOLIO_RATE", "BOOKED_AMT", "BOOKED_COUNT", "SOURCING_ROI", "SOURCING_BOOKED_AMT", "CLOSURE_COUNT", "CLOSURE_RATE") AS 
  select 
   WEEK_OF_YEAR,
   MONTH_LONG, 
   MONTH_LONG_DESC,
   QUARTER_ID, 
   HALF_OF_YEAR_ID, 
   YEAR_ID, ORG_ID, 
   TXN_DT, 
   MONTHLY_POS, 
   PREVIOUS_MONTH_POS_AMT, 
   decode(t.PREVIOUS_MONTH_POS_AMT,0,0,1) Growth_count,
round(nvl((MONTHLY_POS-PREVIOUS_MONTH_POS_AMT)/nullif(PREVIOUS_MONTH_POS_AMT,0),0),5) GROWTH_RATIO, 
   CURRENT_POS, 
   POS_COUNT, 
   TOTAL_INTEREST_OS_BASE_AMOUNT, 
   NPA_POS_AMOUNT, 
   PROVISION_PERCENTAGE,
   PROVISION_AMOUNT, 
   COVERAGE_RATIO, 
   COVERAGE_COUNT, 
   SLIPPAGE_AMOUNT, 
   UPGRADE_AMOUNT, 
   NORMAL_RECOVERY_AMOUNT, 
   UNC_AMOUNT, 
   UNS_AMOUNT, 
   SCHEME_CODE,
   AMOUNT_APPROVED, 
   PRODUCT_CODE, 
   PRODUCT_DESC1, 
   PRORGAM as PROGRAM, 
   PROMOTION, 
   SOURCE_OFFICE_ID,
   GEO_ID,
   BUSINESS_LINE, 
   BUSINESS_SUBLINE, 
   PRODUCT, 
   FACILITY, 
   AGE_BRACKET, 
   NET_INCOME_BRACKET,
   AGENCY_NAME1,
   AGENCY_TYPE_DESC1, 
   CIBIL_SCORE, 
   LTV_DESC1, 
   DBR_DESC1,
   RM_NAME, 
   PROPERTY_TPE,
   BOUNCE_MONTH, 
   BOUNCE_COUNT,
   PRESENTATION_COUNT,
   BOUNCE_RATIO, 
   FORE_POS, 
   PREV_FORE_POS,
   MATURITY_POS, 
   PREV_MATURITY_POS,
   ROI, 
   PORTFOLIO_RATE,
   BOOKED_AMT, 
   BOOKED_COUNT,
   SOURCING_ROI,
   SOURCING_BOOKED_AMT,
   decode(nvl(t.FORE_POS,0),0, 0,1) Closure_count,
round(nvl((t.PREV_FORE_POS/ nullif(t.FORE_POS,0)*100 +
t.PREV_MATURITY_POS/ nullif(t.MATURITY_POS,0)*100),0),5) Closure_rate
from HV_POC01_RATIO_COMPUTE t;
